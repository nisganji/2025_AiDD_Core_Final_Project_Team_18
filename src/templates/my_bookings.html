{% extends "_base.html" %}
{% block content %}
<h3 class="mb-4 fw-bold">My Bookings</h3>
<div class="card p-3">
  {% if bookings %}
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead>
        <tr>
          <th>Resource</th>
          <th>Date</th>
          <th>Start</th>
          <th>End</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
                {% for b in bookings %}
        <tr>
          <td data-label="Resource">
            <a href="{{ url_for('resources.detail', resource_id=b.resource_id) }}" class="text-decoration-none fw-semibold">
              {{ b.resource.title }}
            </a>
          </td>
          <td data-label="Date">{{ b.start_datetime.strftime('%Y-%m-%d') }}</td>
          <td data-label="Start">{{ b.start_datetime.strftime('%H:%M') }}</td>
          <td data-label="End">{{ b.end_datetime.strftime('%H:%M') }}</td>
          <td data-label="Status">
            <span class="badge {{ 'text-bg-success' if b.status=='approved' else 'text-bg-warning' if b.status=='pending' else 'text-bg-danger' if b.status=='rejected' else 'text-bg-secondary' }}">
              {{ b.status|title }}
            </span>
          </td>
          <td data-label="Actions">
            <div class="d-flex gap-2 flex-wrap">
              {% if b.status != 'rejected' %}
                <a href="{{ url_for('bookings.export_ics', booking_id=b.booking_id) }}" class="btn btn-sm btn-outline-secondary" title="Export to calendar">
                  .ics
                </a>
                {% set start_str = b.start_datetime.strftime('%Y%m%dT%H%M%S') %}
                {% set end_str = b.end_datetime.strftime('%Y%m%dT%H%M%S') %}
                {% set title = b.resource.title|urlencode %}
                {% set location = (b.resource.location or 'Campus')|urlencode %}
                {% set details = (b.resource.description or '')[:200]|urlencode %}
                <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text={{ title }}&dates={{ start_str }}/{{ end_str }}&details={{ details }}&location={{ location }}" target="_blank" rel="noopener" class="btn btn-sm btn-brand" title="Add to Google Calendar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                  </svg>
                  Google Calendar
                </a>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-center py-5">
    <p class="text-muted mb-4">No bookings yet.</p>
    <a href="{{ url_for('resources.browse') }}" class="btn btn-brand">Browse Resources</a>
  </div>
  {% endif %}
</div>
{% endblock %}

