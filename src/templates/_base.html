{% set title = title or "Campus Resource Hub" %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }}</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/theme.css') }}" rel="stylesheet">
    {% if include_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    {% endif %}
  </head>
  <body>
    <a class="sr-only" href="#main">Skip to content</a>
    <nav class="navbar navbar-expand-lg navbar-dark" role="navigation" aria-label="Main navigation">
      <div class="container">
        <a class="navbar-brand fw-bold" href="{{ url_for('main.home') }}">Campus Resource Hub</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon" aria-hidden="true"></span>
          <span class="sr-only">Toggle nav</span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto align-items-center gap-2">
            <li class="nav-item">
              <button class="btn search-trigger-btn" type="button" data-bs-toggle="modal" data-bs-target="#searchModal" aria-label="Search resources">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right:0.5rem;">
                  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                Search
              </button>
            </li>
            
            <li class="nav-item d-none"><button class="btn btn-sm btn-outline-light" aria-label="Theme disabled">
              <span class="theme-icon">ðŸŒ™</span>
            </button></li>
            {% if current_user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('messages.inbox') }}">Messages</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('users.profile') }}">Settings</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('bookings.my_bookings') }}">My Bookings</a></li>
              {% if current_user.role in ['staff','admin'] %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('admin.dashboard') }}">Admin</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('reports.weekly_summary') }}">AI Summary</a></li>
              {% endif %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Sign out</a></li>
            {% else %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Sign in</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.register') }}">Sign up</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Search Modal Popup -->
    <div class="modal fade search-modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold" id="searchModalLabel">Search Resources</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form method="get" action="{{ url_for('resources.browse') }}" id="searchForm">
              <div class="centered-search mb-4">
                <div class="input-group input-group-lg">
                  <input type="search" class="form-control" name="q" placeholder="Search by keyword, location, or description..." value="{{ request.args.get('q','') }}" aria-label="Search resources">
                  <button class="btn btn-brand" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Availability Date</label>
                  <input type="date" class="form-control" name="date" value="{{ request.args.get('date','') }}" aria-label="Availability date">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Time Slot</label>
                  <select class="form-select" name="slot" aria-label="Time slot">
                    <option value="">Any time</option>
                    {% for s in ['08:00-09:00','09:00-10:00','10:00-11:00','11:00-12:00','13:00-14:00','14:00-15:00','15:00-16:00'] %}
                    <option value="{{s}}" {{ 'selected' if request.args.get('slot')==s else '' }}>{{s}}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Category</label>
                  <select class="form-select" name="category" aria-label="Category">
                    <option value="">All categories</option>
                    {% for c in ['Classroom','Conference Room','Lab','Equipment'] %}
                    <option value="{{c}}" {{ 'selected' if request.args.get('category')==c else '' }}>{{c}}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Location</label>
                  <input type="text" class="form-control" name="location" placeholder="e.g., Main Building" value="{{ request.args.get('location','') }}" aria-label="Location">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Minimum Capacity</label>
                  <input type="number" min="1" class="form-control" name="capacity" placeholder="e.g., 20" value="{{ request.args.get('capacity','') }}" aria-label="Minimum capacity">
                </div>
                <div class="col-md-12">
                  <label class="form-label">Sort By</label>
                  <select class="form-select" name="sort">
                    {% for v,l in [('recent','Recent'),('booked','Most booked'),('rated','Top rated')] %}
                    <option value="{{v}}" {{ 'selected' if request.args.get('sort')==v else '' }}>{{l}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" form="searchForm" class="btn btn-brand">Search</button>
          </div>
        </div>
      </div>
    </div>
    <main id="main" class="container my-4">
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% for c, m in messages %}
        <div class="alert alert-{{c}} rounded-3" role="status">{{m}}</div>
      {% endfor %}{% endwith %}
      {% block content %}{% endblock %}
    </main>
    <footer class="container my-4 text-muted">Â© 2025 Campus Resource Hub â€¢ <a href="{{ url_for('reports.api_docs') }}">API Docs</a></footer>
    {% if include_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% endif %}
  </body>
</html>
